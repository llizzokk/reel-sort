{"version":3,"file":"page-3.js","sources":["../src/top-page.js"],"sourcesContent":["'use strict';\n\nimport './css/top-page.css';\nimport axios from 'axios';\nimport 'loaders.css';\n\nconst BASE_URL = 'https://api.themoviedb.org/3';\nconst TOP_RATED_ENDPOINT = '/movie/top_rated';\nconst SEARCH_ENDPOINT = '/search/movie';\nconst API_KEY = '5cd3b967f25ca5ea88c6b3955d7951c5';\n\nconst container = document.querySelector('.moviesContainer');\nconst button = document.getElementById('top-load-btn');\nconst form = document.querySelector('.top-form');\nconst loader = document.querySelector('.loader-container');\nconst errorMessage = document.querySelector('.error');\nconst modal = document.querySelector('.modal');\nconst modalCloseBtn = document.querySelector('.modal-close-btn');\nconst modalInfo = document.querySelector('.modal-info');\n\nlet currentPage = 1;\nlet currentSearch = '';\nlet movies = [];\n\nasync function serviceTopMovie(searchValue = '', page = 1) {\n  const endpoint = searchValue ? SEARCH_ENDPOINT : TOP_RATED_ENDPOINT;\n\n  try {\n    loader.style.display = 'block';\n    const { data } = await axios(`${BASE_URL}${endpoint}`, {\n      params: {\n        api_key: API_KEY,\n        query: searchValue,\n        language: window.currentLanguage || 'en',\n        page,\n      },\n    });\n    button.classList.replace('load-more-hidden', 'btn');\n    return data.results;\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n    return [];\n  } finally {\n    loader.style.display = 'none';\n  }\n}\n\n(async function loadInitialMovies() {\n  try {\n    movies = await serviceTopMovie();\n    renderMovies(movies);\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n  }\n})();\n\nfunction createTopMarkup(arr) {\n  return arr\n    .map(\n      ({ poster_path, title }) => `<li class=\"movies-list-item\">\n          <img src=\"https://image.tmdb.org/t/p/w200${poster_path}\" alt=\"${title}\" class=\"movies-item-img\" width=\"234\" height=\"351\">\n          <h3 class=\"movies-item-title\">${title}</h3>\n      </li>`\n    )\n    .join('');\n}\n\nfunction renderMovies(movies) {\n  if (!movies || movies.length === 0) {\n    errorMessage.classList.replace('error-hidden', 'error-message');\n    return;\n  }\n  errorMessage.classList.replace('error-message', 'error-hidden');\n  const moviesMarkup = createTopMarkup(movies);\n  container.insertAdjacentHTML('beforeend', moviesMarkup);\n}\n\nbutton.addEventListener('click', handleLoad);\nform.addEventListener('submit', handleSubmit);\nmodalCloseBtn.addEventListener('click', closeModal);\n\ncontainer.addEventListener('click', event => {\n  const movieItem = event.target.closest('.movies-list-item');\n  if (movieItem) {\n    const index = [...container.children].indexOf(movieItem);\n    handleMovieClick(movies[index]);\n  }\n});\n\nasync function handleLoad() {\n  button.classList.replace('btn', 'load-more-hidden');\n  button.disabled = true;\n  currentPage += 1;\n\n  try {\n    const newMovies = await serviceTopMovie(currentSearch, currentPage);\n    movies = [...movies, ...newMovies];\n    renderMovies(newMovies);\n\n    const movieItem = document.querySelector('.movies-list-item');\n    if (movieItem) {\n      const itemHeight = movieItem.getBoundingClientRect().height;\n      window.scrollBy({\n        left: 0,\n        top: itemHeight,\n        behavior: 'smooth',\n      });\n    }\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n  } finally {\n    button.classList.replace('load-more-hidden', 'btn');\n    button.disabled = false;\n  }\n}\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n\n  const searchValue = event.currentTarget.elements.search.value.trim();\n\n  if (searchValue !== currentSearch) {\n    currentSearch = searchValue;\n    currentPage = 1;\n    container.innerHTML = '';\n  }\n\n  loader.classList.remove('hidden');\n  button.classList.replace('btn', 'load-more-hidden');\n\n  try {\n    movies = await serviceTopMovie(searchValue, currentPage);\n    renderMovies(movies);\n\n    if (movies.length > 0) {\n      button.classList.replace('load-more-hidden', 'btn');\n    }\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n  } finally {\n    loader.classList.add('hidden');\n    event.target.elements.search.value = '';\n  }\n}\n\nfunction handleMovieClick(movie) {\n  const { title, overview, poster_path, release_date, vote_average } = movie;\n\n  modalInfo.innerHTML = `\n    <img src=\"https://image.tmdb.org/t/p/w500${poster_path}\" alt=\"${title}\" width=\"300\" class=\"modal-img\">\n    <div class=\"modal-wrap\">\n    <h2 class=\"modal-title\">${title}</h2>\n    <p class=\"modal-text\">Release Date: <span class=\"modal-text-span\">${release_date}</span></p>\n    <p class=\"modal-text\">Rating: <span class=\"modal-text-span\">${vote_average}</span></p>\n    <p class=\"modal-text\">Overview: <span class=\"modal-text-span\">${overview}</span></p>\n    </div>\n  `;\n\n  modal.classList.remove('hidden');\n}\n\nfunction closeModal() {\n  modal.classList.add('hidden');\n}\n\nmodal.addEventListener('click', event => {\n  if (event.target === modal) {\n    closeModal();\n  }\n});\n\nwindow.addEventListener('languageChange', async () => {\n  container.innerHTML = '';\n  currentSearch = '';\n  currentPage = 1;\n  movies = [];\n\n  try {\n    movies = await serviceTopMovie();\n    renderMovies(movies);\n  } catch (error) {\n    console.error('Error loading movies on language change:', error.message);\n  }\n});\n"],"names":["BASE_URL","TOP_RATED_ENDPOINT","SEARCH_ENDPOINT","API_KEY","container","button","form","loader","errorMessage","modal","modalCloseBtn","modalInfo","currentPage","currentSearch","movies","serviceTopMovie","searchValue","page","endpoint","data","axios","error","renderMovies","createTopMarkup","arr","poster_path","title","moviesMarkup","handleLoad","handleSubmit","closeModal","event","movieItem","index","handleMovieClick","newMovies","itemHeight","movie","overview","release_date","vote_average"],"mappings":"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"}