{"version":3,"file":"page-3.js","sources":["../src/top-page.js"],"sourcesContent":["'use strict';\n\nimport './css/top-page.css';\nimport axios from 'axios';\nimport 'loaders.css';\n\nconst BASE_URL = 'https://api.themoviedb.org/3';\nconst TOP_RATED_ENDPOINT = '/movie/top_rated';\nconst SEARCH_ENDPOINT = '/search/movie';\nconst API_KEY = '5cd3b967f25ca5ea88c6b3955d7951c5';\n\nconst container = document.querySelector('.moviesContainer');\nconst button = document.getElementById('top-load-btn');\nconst form = document.querySelector('.top-form');\nconst loader = document.querySelector('.loader-container');\nconst errorMessage = document.querySelector('.error');\n\nlet currentPage = 1;\nlet currentSearch = '';\n\nasync function serviceTopMovie(searchValue = '', page = 1) {\n  const endpoint = searchValue ? SEARCH_ENDPOINT : TOP_RATED_ENDPOINT;\n\n  try {\n    loader.style.display = 'block';\n    const { data } = await axios(`${BASE_URL}${endpoint}`, {\n      params: {\n        api_key: API_KEY,\n        query: searchValue,\n        page,\n      },\n    });\n    return data.results;\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n    return [];\n  } finally {\n    loader.style.display = 'none';\n  }\n}\n\n(async function loadInitialMovies() {\n  try {\n    const movies = await serviceTopMovie();\n    renderMovies(movies);\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n  }\n})();\n\nfunction createTopMarkup(arr) {\n  return arr\n    .map(\n      ({ poster_path, title }) => `<li class=\"movies-list-item\">\n          <img src=\"https://image.tmdb.org/t/p/w200${poster_path}\" alt=\"${title}\" class=\"movies-item-img\" width=\"234\" height=\"351\">\n          <h3 class=\"movies-item-title\">${title}</h3>\n      </li>`\n    )\n    .join('');\n}\n\nfunction renderMovies(movies) {\n  if (!movies || movies.length === 0) {\n    errorMessage.classList.replace('error-hidden', 'error-message');\n    return;\n  }\n  errorMessage.classList.replace('error-message', 'error-hidden');\n  const moviesMarkup = createTopMarkup(movies);\n  container.insertAdjacentHTML('beforeend', moviesMarkup);\n}\n\nbutton.addEventListener('click', handleLoad);\nform.addEventListener('submit', handleSubmit);\n\nasync function handleLoad() {\n  button.classList.replace('btn', 'load-more-hidden');\n  button.disabled = true;\n  currentPage += 1;\n\n  try {\n    const movies = await serviceTopMovie(currentSearch, currentPage);\n    renderMovies(movies);\n\n    const movieItem = document.querySelector('.movies-list-item');\n    if (movieItem) {\n      const itemHeight = movieItem.getBoundingClientRect().height;\n      window.scrollBy({\n        left: 0,\n        top: itemHeight,\n        behavior: 'smooth',\n      });\n    }\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n  } finally {\n    button.classList.replace('load-more-hidden', 'btn');\n    button.disabled = false;\n  }\n}\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n\n  const searchValue = event.currentTarget.elements.search.value.trim();\n\n  if (searchValue !== currentSearch) {\n    currentSearch = searchValue;\n    currentPage = 1;\n    container.innerHTML = '';\n  }\n\n  loader.classList.remove('hidden');\n  button.classList.replace('btn', 'load-more-hidden');\n\n  try {\n    const movies = await serviceTopMovie(searchValue, currentPage);\n    renderMovies(movies);\n\n    if (movies.length > 0) {\n      button.classList.replace('load-more-hidden', 'btn');\n    }\n  } catch (error) {\n    console.log(error.message);\n    errorMessage.classList.replace('error-hidden', 'error-message');\n  } finally {\n    loader.classList.add('hidden');\n    event.target.elements.search.value = '';\n  }\n}\n"],"names":["BASE_URL","TOP_RATED_ENDPOINT","SEARCH_ENDPOINT","API_KEY","container","button","form","loader","errorMessage","currentPage","currentSearch","serviceTopMovie","searchValue","page","endpoint","data","axios","error","movies","renderMovies","createTopMarkup","arr","poster_path","title","moviesMarkup","handleLoad","handleSubmit","movieItem","itemHeight","event"],"mappings":"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"}